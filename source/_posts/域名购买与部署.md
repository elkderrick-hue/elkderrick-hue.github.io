---
title: 域名购买与部署
date: 2026-02-01 15:00:00
tags:
  - GitHub Pages
  - Hexo
  - Butterfly
  - 域名
  - Cloudflare
  - DNSPod
  - 踩坑
categories:
  - 技术
---

## 前言

我把博客部署在 GitHub Pages 上后，默认网址是 `用户名.github.io`。  
能用，但不好记，也不够“像一个正式的网站”。

所以我决定给博客买一个独立域名：**debugdiary.top**，并绑定到 GitHub Pages。  
这篇文章记录我从“买域名”到“真正能访问”的完整过程，以及中途踩过的坑（尤其是 DNSPod 的限制和 Cloudflare 的配置）。

---

## 目标效果

最终我希望达到：

- 主站使用：`https://www.debugdiary.top`
- 裸域也能访问：`https://debugdiary.top`
- 裸域自动 301 跳转到 www（统一入口，避免 SEO/缓存混乱）
- 全站 HTTPS 可用（不花钱）

---

## Step 1：在腾讯云买域名（不要被“增值服务”带跑）

我是在腾讯云注册的域名。购买页会推荐一些搭售服务，比如：

- 轻量应用服务器
- DNS 解析（专业版）
- SSL 证书

对于 **GitHub Pages + Hexo 静态站**来说，这些都 **不需要**：

- 静态站不需要服务器
- DNS 解析基础版完全够用（后面我甚至直接切到 Cloudflare）
- HTTPS 证书 GitHub Pages 可以免费签发

✅ 建议：只买域名本身，其他都不选。

![购买域名时的增值服务提示](/img/posts/debugdiary-domain/domain-addon.png)

---

## Step 2：准备 DNS 解析（我为什么选择 Cloudflare）

我一开始打算在 DNSPod 里直接按 GitHub Pages 官方做法配置：

- `www` 用 CNAME 指向 `用户名.github.io`
- 裸域 `@` 用 4 条 A 记录指向 GitHub Pages 的 IP

但是很快遇到一个现实问题：**DNSPod 套餐限制**。

---

## 踩坑 1：DNSPod 报错「子域名负载均衡数量超出套餐限制」

当我给 `@` 添加多条 A 记录时，DNSPod 把它当作“负载均衡/轮询”，提示超出套餐限制。



### 解决思路

我不想为了一个个人博客升级 DNS 套餐，所以改用方案：

✅ 把 DNS 解析交给 Cloudflare（免费）

优点：

- 不受 DNSPod 的“多 A 记录/负载均衡”限制影响
- 规则/跳转能力更强（可以做裸域自动跳 www）
- 后续如果还想加 CDN/缓存等，也更方便

---

## Step 3：把域名 NS（DNS 服务器）切到 Cloudflare（关键步骤）

### 3.1 在 Cloudflare 添加站点

在 Cloudflare 添加站点 `debugdiary.top`，选择 Free 套餐。  
Cloudflare 会分配两条 Nameserver（NS），类似：

- `xxxxxx.ns.cloudflare.com`
- `yyyyy.ns.cloudflare.com`

### 3.2 在腾讯云修改 NS

进入腾讯云域名控制台，把域名的 DNS 服务器改为 Cloudflare 给的两条 NS。

![腾讯云已修改 NS 到 Cloudflare](/img/posts/debugdiary-domain/tencent-ns-changed.png)

---

## 踩坑 2：我在 Cloudflare 配了记录，但一直不生效（原因：NS 还没切过去）

我一开始在 Cloudflare DNS 里加了记录，但发现：

- DNS 页面有黄色警告
- 还残留 DNSPod 的 NS 记录（`lark.dnspod.net / tree.dnspod.net`）
- 规则/跳转似乎不稳定

后来才意识到：**没有切 NS，Cloudflare 就不是权威 DNS**，很多配置不会真正生效。


✅ 正确做法：先在腾讯云把 NS 改到 Cloudflare，再回 Cloudflare 清理掉残留的 DNSPod NS 记录。

---

## Step 4：在 Cloudflare 添加 DNS 记录（让域名指向 GitHub Pages）

进入 Cloudflare → DNS → Records，添加两条记录：

### 4.1 `www` 记录（必须）

- Type：CNAME
- Name：`www`
- Target：`elkderrick-hue.github.io`

### 4.2 裸域 `@` 记录（推荐）

我用的是 CNAME（Cloudflare 会做扁平化）：

- Type：CNAME
- Name：`@`
- Target：`elkderrick-hue.github.io`

> 这样裸域也能解析到 GitHub Pages，后面再用规则把裸域 301 到 www。

---

## Step 5：在 GitHub Pages 绑定自定义域名

进入仓库 `elkderrick-hue.github.io`：

Settings → Pages → Custom domain

填入：

- `www.debugdiary.top`

保存后等待 DNS check 通过，再开启：

- Enforce HTTPS

---

## Step 6：让裸域自动跳转到 www（Cloudflare Page Rules）

我希望用户输入 `debugdiary.top` 时，自动跳到 `www.debugdiary.top`。

进入 Cloudflare → Rules → Page Rules，新增规则：

- If the URL matches：
  - `debugdiary.top/*`
- Then the settings are：
  - Forwarding URL
  - 301 - Permanent Redirect
  - Destination URL：
    - `https://www.debugdiary.top/$1`

![Cloudflare Page Rules 配置跳转](/img/posts/debugdiary-domain/cloudflare-page-rule.png)

这样：

- `debugdiary.top/posts/abc` 会跳到 `www.debugdiary.top/posts/abc`

---

## Step 7：修改 Hexo 的站点配置（非常重要，否则链接会乱）

本地打开 Hexo 根目录 `_config.yml`，修改：

~~~yml
url: https://www.debugdiary.top
root: /
~~~

然后发布：

~~~bash
hexo clean
git add -A
git commit -m "update site url to custom domain"
git push
~~~

---

## 最终验证清单（我用这 4 步确认都 OK）

1. 打开 `https://www.debugdiary.top`：✅ 博客正常加载
2. 打开 `https://debugdiary.top`：✅ 自动跳到 www
3. GitHub Pages Settings → Pages：✅ Custom domain 显示正常、HTTPS 可开启
4. 网站内文章链接/资源路径：✅ 没有出现 `用户名.github.io` 的旧链接

---

## 这次踩坑总结（最值得记住的点）

1）腾讯云买域名时，不要被增值服务诱导  
静态站只买域名即可，DNS/SSL/服务器大多数情况都不需要。

2）DNSPod 的“多 A 记录”可能触发套餐限制  
想省事省钱：直接交给 Cloudflare 免费 DNS。

3）Cloudflare 规则不生效，先检查 NS 是否真的切过去了  
没切 NS，一切配置都可能“看起来做了，但其实没生效”。

4）域名绑好后，Hexo 的 `url` 一定要改  
否则 RSS、文章永久链接、资源路径可能混乱。

---

## 结语

这次从买域名到绑定 GitHub Pages，最大的收获是：

> 域名绑定并不复杂，真正容易卡住的是「谁是权威 DNS」和「平台套餐限制」。

现在 `debugdiary.top` 已经正常上线。  
以后我会把更多搭建过程/优化记录继续写在这个站上（也算一份长期的 debug diary）。

（完）
